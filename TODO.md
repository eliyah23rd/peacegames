# Peacegames TODO

## To Do
- [ ] Add any additional repo workflows if discovered in future requests.

## Done
- [x] Ran `python run_all_tests.py` before changes (2026-02-02).
- [x] Drafted repo skill at `skills/peacegames/SKILL.md`.
- [x] Added command/workflow runbook in `skills/peacegames/references/commands.md`.
- [x] Added tests for skill/todo presence in `tests/test_skill_files.py`.
- [x] Re-ran `python run_all_tests.py` after changes (2026-02-02).
- [x] Re-ran `python run_all_tests.py` after TODO updates (2026-02-02).
- [x] Committed and pushed changes (including latest TODO update).
- [x] Ran `python run_all_tests.py` before updating TODO for sim-viewer reminder (2026-02-02).
- [x] Re-ran `python run_all_tests.py` after TODO update (2026-02-02).
- [x] Ran `python run_all_tests.py` before updating skill file for test policy (2026-02-02).
- [x] Updated `skills/peacegames/SKILL.md` with conditional test-running rule.
- [x] Re-ran `python run_all_tests.py` after skill update (2026-02-02).
- [x] Ran `python run_all_tests.py` before updating TODO for skills/todo location question (2026-02-02).
- [x] Re-ran `python run_all_tests.py` after TODO update (2026-02-02).
- [x] Ran `python run_all_tests.py` before responding to map overlay/name mismatch question (2026-02-02).
- [x] Ran `python run_all_tests.py` before editing map generator for name overrides (2026-02-02).
- [x] Updated map JSON generation to use `name_overrides.json` for UI labels.
- [x] Applied permanent fix and regenerated map outputs.
- [x] Re-ran `python run_all_tests.py` after map generator update (2026-02-02).
- [x] Ran `python run_all_tests.py` before updating notice-board legend rendering (2026-02-02).
- [x] Fit legend data (players, pie colors, resource icons) into notice board overlay.
- [x] Re-ran `python run_all_tests.py` after legend update (2026-02-02).
- [x] Ran `python run_all_tests.py` before adjusting notice-board legend layout (2026-02-02).
- [x] Shifted notice-board legend right, brightened/bolded text, and removed external legend above map.
- [x] Re-ran `python run_all_tests.py` after legend layout update (2026-02-02).
- [x] Ran `python run_all_tests.py` before fixing blank map issue (2026-02-02).
- [x] Restored hidden map legend container and cache-busted app.js to fix blank map.
- [x] Re-ran `python run_all_tests.py` after adding map render logging (2026-02-02).
- [x] Re-ran `python run_all_tests.py` after fixing map logging syntax error (2026-02-02).
- [x] Ran `python run_all_tests.py` before updating notice-board legend text styling (2026-02-02).
- [x] Adjusted notice-board legend text color to dark purple and slightly larger font.
- [x] Re-ran `python run_all_tests.py` after notice-board legend text update (2026-02-02).
- [x] Ran `python run_all_tests.py` before changing contiguity table and assignment algorithm (2026-02-02).
- [x] Created fixed territory contiguity matrix file under tests for manual tweaks.
- [x] Improved territory assignment to swap territories when an agent is stuck.
- [x] Resolved map image not loading in UI.
- [x] Re-ran `python run_all_tests.py` after contiguity/assignment updates (2026-02-02).
- [x] Enforced no-random fallback and capital-protected swaps in assignment.
- [x] Updated tests to allow unassigned territories when agents get stuck.
- [x] Re-ran `python run_all_tests.py` after assignment rule changes (2026-02-02).
- [x] Ran `python run_all_tests.py` before adding 1-turn resource demo setup (2026-02-02).
- [x] Added 1-turn resource demo setup file for map testing.
- [x] Re-ran `python run_all_tests.py` after adding 1-turn resource demo setup (2026-02-02).
- [x] Ran `python run_all_tests.py` before updating TODO for fixed-map usage question (2026-02-02).
- [x] Re-ran `python run_all_tests.py` after TODO update (2026-02-02).
- [x] Confirmed sim run used fixed-map territories from `worldmap/world_territories_32.json`.
- [x] Ran `python run_all_tests.py` before updating TODO for sim map usage question (2026-02-02).
- [x] Re-ran `python run_all_tests.py` after TODO update (2026-02-02).

## Notes & Insights
- Keep this file updated for each user request: add tasks, mark done, and capture notable decisions.
- Skill created at `skills/peacegames/` with runbook in `skills/peacegames/references/commands.md`.
- User asked how to view end-of-round data and world map after a new sim.
- User asked whether the latest sim used fixed-map territories from `worldmap/world_territories_32.json`.
- User ran `python -m run_llm_resource_simulation initial_setup/resource_demo_4p.json --model gpt-5.1 diplomacy,opportunist,austerity,sneaky`.
- User asked where the skills file and TODO are located.
- User requested updating the skill to only require tests when changing .py or data files.
- User reported territory names not matching expected map overlays.
- User noted `world_map_32_internal_labeled.png` has the correct names; likely mismatch between UI JSON cache and updated map assets.
- Root cause: `draw_terrs_v2.py` writes `world_territories_32.json` using default names, not `name_overrides.json`.
- Regenerated `worldmap/world_territories_32.json` after applying name overrides.
- User asked to fit legend data into notice board on the map.
- Added notice-board legend drawing in `peacegame/worldmap_renderer.py`.
- User wants legend moved right, bolder/bright text, and external legend removed.
- Removed map legend from UI to avoid duplicate legend above map.
- User reports map not showing after UI restart; likely cached JS or /api/map failure.
- Fixed syntax error in /api/map logging f-string.
- Added server-side map render logs for debugging.
- User reports map not showing after UI changes; likely cached JS or missing mapLegend element.
- Added `tests/territory_contiguity.json` for fixed-map adjacency matrix edits.
- Updated assignment to avoid swapping away capitals and to stop assigning when stuck.
- Updated tests to reflect that not all territories must be assigned.
